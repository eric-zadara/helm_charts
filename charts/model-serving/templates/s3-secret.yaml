{{- if .Values.s3Storage.enabled }}
# S3-compatible storage credentials for KServe StorageInitializer
# For production: use Sealed Secrets, External Secrets Operator, or Vault
# rather than storing credentials in values.yaml
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.s3Storage.secretName }}
  labels:
    {{- include "model-serving.labels" . | nindent 4 }}
  annotations:
    serving.kserve.io/s3-endpoint: {{ .Values.s3Storage.endpoint | quote }}
    serving.kserve.io/s3-usehttps: {{ .Values.s3Storage.useHttps | quote }}
    serving.kserve.io/s3-verifyssl: {{ .Values.s3Storage.verifySsl | quote }}
    serving.kserve.io/s3-region: {{ .Values.s3Storage.region | quote }}
type: Opaque
{{- if .Values.s3Storage.accessKeyId }}
stringData:
  AWS_ACCESS_KEY_ID: {{ .Values.s3Storage.accessKeyId | quote }}
  AWS_SECRET_ACCESS_KEY: {{ .Values.s3Storage.secretAccessKey | quote }}
{{- else }}
# Credentials must be provided via --set or external secret management
# Example: helm upgrade --set s3Storage.accessKeyId=$AWS_KEY --set s3Storage.secretAccessKey=$AWS_SECRET
data: {}
{{- end }}
{{- end }}

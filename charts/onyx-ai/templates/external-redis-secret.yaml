{{/*
External Redis Secret

This Secret is created ONLY when:
  1. externalRedis.host is set (using external Redis)
  2. externalRedis.existingSecret is NOT set (no pre-existing secret)
  3. externalRedis.password IS set (credentials provided inline)

The secret key 'redis_password' matches the upstream OT Redis pattern,
ensuring consistency with auth.redis.secretKeys.REDIS_PASSWORD.

When this secret is created, the helper onyx-ai.redis.secretName returns
"{fullname}-external-redis" which matches this secret's name.
*/}}
{{- if .Values.externalRedis.host }}
{{- if not .Values.externalRedis.existingSecret }}
{{- if .Values.externalRedis.password }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "onyx-ai.fullname" . }}-external-redis
  labels:
    {{- include "onyx-ai.labels" . | nindent 4 }}
    app.kubernetes.io/component: redis
  annotations:
    argocd.argoproj.io/sync-wave: "-1"
type: Opaque
stringData:
  # Key matches upstream OT Redis pattern: redis_password
  # Referenced via REDIS_PASSWORD env var in Onyx pods
  redis_password: {{ .Values.externalRedis.password | quote }}
{{- end }}
{{- end }}
{{- end }}

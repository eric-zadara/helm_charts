{{/*
Redis Host Override ConfigMap

This ConfigMap overrides the REDIS_HOST (and optionally REDIS_PORT) values
from the upstream Onyx chart's configmap.yaml. The upstream template sets:
  REDIS_HOST: {{ .Values.redis.redisStandalone.name | default .Release.Name }}-master

Our wrapper chart supports three Redis modes:
  1. Default OT Redis: {release}-master (matches upstream)
  2. Spotahome HA: rfr-{release}-redis-ha (Redis pods, not Sentinel)
  3. External: externalRedis.host from values

The upstream configmap.yaml uses `.Values.redis.enabled` conditional,
so this ConfigMap is loaded regardless of mode to ensure correct host.

Onyx environment variables for Redis:
  - REDIS_HOST: Redis server hostname
  - REDIS_PORT: Redis server port (default 6379)
  - REDIS_SSL: Enable TLS (true/false) - only for external with TLS
  - REDIS_DB_NUMBER: Database number for general operations
*/}}
{{- include "onyx-ai.redis.validate" . -}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "onyx-ai.fullname" . }}-redis-config
  labels:
    {{- include "onyx-ai.labels" . | nindent 4 }}
    app.kubernetes.io/component: redis-config
data:
  # Redis host based on mode: External > HA > Default
  REDIS_HOST: {{ include "onyx-ai.redis.host" . | quote }}
  # Port (6379 for internal, configurable for external)
  REDIS_PORT: {{ include "onyx-ai.redis.port" . | quote }}
  {{- /* Database number */ -}}
  {{- $dbNum := include "onyx-ai.redis.database" . -}}
  {{- if ne $dbNum "0" }}
  REDIS_DB_NUMBER: {{ $dbNum | quote }}
  {{- end }}
  {{- /* TLS configuration for external Redis */ -}}
  {{- if eq (include "onyx-ai.redis.tlsEnabled" .) "true" }}
  REDIS_SSL: "true"
  {{- end }}

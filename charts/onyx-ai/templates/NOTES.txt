{{- $fullName := include "onyx-ai.fullname" . -}}

╔═══════════════════════════════════════════════════════════════════╗
║                    Onyx has been deployed!                        ║
╚═══════════════════════════════════════════════════════════════════╝

Release: {{ .Release.Name }}
Namespace: {{ .Release.Namespace }}
Chart Version: {{ .Chart.Version }}
App Version: {{ .Chart.AppVersion }}
Variant: {{ .Values.variant | default "onyx" }}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

STATUS CHECK
============

To check the status of all pods:

  kubectl get pods -n {{ .Release.Namespace }} -l app.kubernetes.io/instance={{ .Release.Name }}

To watch pods come up:

  kubectl get pods -n {{ .Release.Namespace }} -w

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

ACCESSING ONYX
==============

{{- if .Values.onyx.nginx.enabled }}

Onyx is accessible via the nginx LoadBalancer service:

  kubectl get svc -n {{ .Release.Namespace }} {{ .Release.Name }}-nginx-controller

{{- else }}

NOTE: The upstream nginx ingress is disabled.

{{- if .Values.onyx.ingress.enabled }}

Onyx is accessible via the configured ingress at:
  {{ .Values.onyx.ingress.api.host | default "onyx.local" }}

{{- else }}

To access Onyx, configure an ingress controller or use port-forwarding:

  # Port-forward the API server
  kubectl port-forward -n {{ .Release.Namespace }} svc/{{ .Release.Name }}-onyx-api-service 8080:8080

  # Port-forward the web server
  kubectl port-forward -n {{ .Release.Namespace }} svc/{{ .Release.Name }}-onyx-webserver 3000:3000

Then access the web UI at: http://localhost:3000

{{- end }}
{{- end }}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

CONFIGURATION
=============

LLM providers are configured through the Onyx admin interface after
deployment, not via Helm values. The GEN_AI_* environment variables
are deprecated.

For more information, visit: https://docs.onyx.app/

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
{{- if or .Values.objectStorage.existingSecret .Values.objectStorage.accessKey }}

OBJECT STORAGE CONFIGURATION
============================
{{- if .Values.objectStorage.existingSecret }}

Using existing S3 credentials secret: {{ .Values.objectStorage.existingSecret }}
{{- else if .Values.objectStorage.accessKey }}

Created S3 credentials secret: {{ include "onyx-ai.fullname" . }}-external-objectstorage
{{- end }}

{{- if not .Values.objectStorage.useIAM }}

IMPORTANT: S3 credentials require dual-configuration in values.yaml.

WHY: Helm values.yaml cannot contain template expressions (like {{ "{{" }} include {{ "}}" }}).
Templates are evaluated at render time, but values.yaml is parsed BEFORE rendering.
Therefore, existingSecret cannot be auto-computed from objectStorage settings.

To wire S3 credentials to Onyx pods, ensure your values include:

  onyx:
    auth:
      objectstorage:
        enabled: true
{{- if .Values.objectStorage.existingSecret }}
        existingSecret: "{{ .Values.objectStorage.existingSecret }}"
{{- else if .Values.objectStorage.accessKey }}
        existingSecret: "{{ include "onyx-ai.fullname" . }}-external-objectstorage"
{{- end }}

{{- if .Values.objectStorage.accessKey }}
Example command to upgrade with correct wiring:

  helm upgrade {{ .Release.Name }} {{ .Chart.Name }} \
    --set onyx.auth.objectstorage.existingSecret="{{ include "onyx-ai.fullname" . }}-external-objectstorage" \
    [other values...]
{{- end }}
{{- end }}

{{- if .Values.objectStorage.useIAM }}

IAM Mode: S3 credentials are not configured. Ensure pods have IAM role access.
Set onyx.auth.objectstorage.enabled=false in your values.
{{- end }}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
{{- end }}

{{/*
CI/Test secrets - only created when using external resources without existing secrets.
These are for testing purposes only. In production, secrets are managed externally
or created by CNPG/Valkey subcharts.
*/}}
{{- if and (not .Values.database.internal.enabled) .Values.database.external.secretName }}
{{- $secretName := .Values.database.external.secretName }}
{{- $key := .Values.database.external.passwordSecretKey }}
{{- /* Only create if the secret name matches our naming pattern (indicates CI/test) */ -}}
{{- if hasPrefix (include "litellm-proxy.fullname" .) $secretName }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ $secretName }}
  labels:
    {{- include "litellm-proxy.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": pre-install
    "helm.sh/hook-delete-policy": before-hook-creation
type: Opaque
stringData:
  {{ $key }}: "ci-test-password"
{{- end }}
{{- end }}
{{- if and .Values.cache.enabled (not .Values.cache.internal.enabled) .Values.cache.external.secretName }}
{{- $secretName := .Values.cache.external.secretName }}
{{- $key := .Values.cache.external.passwordSecretKey }}
{{- /* Only create if the secret name matches our naming pattern (indicates CI/test) */ -}}
{{- if hasPrefix (include "litellm-proxy.fullname" .) $secretName }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ $secretName }}
  labels:
    {{- include "litellm-proxy.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": pre-install
    "helm.sh/hook-delete-policy": before-hook-creation
type: Opaque
stringData:
  {{ $key }}: "ci-test-password"
{{- end }}
{{- end }}
